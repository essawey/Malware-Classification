Welcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.15.133.1-microsoft-standard-WSL2 x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

 * Strictly confined Kubernetes makes edge and IoT secure. Learn how MicroK8s
   just raised the bar for easy, resilient and secure K8s cluster deployment.

   https://ubuntu.com/engage/secure-kubernetes-at-the-edge

This message is shown once a day. To disable it please create the
/home/essawey/.hushlogin file.
essawey@essawey:~$    curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   138  100   138    0     0    363      0 --:--:-- --:--:-- --:--:--   364
100 49.0M  100 49.0M    0     0  3199k      0  0:00:15  0:00:15 --:--:-- 3303k
essawey@essawey:~$ sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl
[sudo] password for essawey:
essawey@essawey:~$ kubectl version --client
Client Version: v1.30.1
Kustomize Version: v5.0.4-0.20230601165947-6ce0bf390ce3
essawey@essawey:~$ kubectl version --client --output=yaml
clientVersion:
  buildDate: "2024-05-14T10:50:53Z"
  compiler: gc
  gitCommit: 6911225c3f747e1cd9d109c305436d08b668f086
  gitTreeState: clean
  gitVersion: v1.30.1
  goVersion: go1.22.2
  major: "1"
  minor: "30"
  platform: linux/amd64
kustomizeVersion: v5.0.4-0.20230601165947-6ce0bf390ce3

essawey@essawey:~$ nano kubeconfig.yaml
essawey@essawey:~$ export KUBECONFIG=kubeconfig.yaml
essawey@essawey:~$ kubectl get nodes
NAME                            STATUS   ROLES    AGE     VERSION
lke184126-266221-29d3fcf00000   Ready    <none>   5m13s   v1.29.2
lke184126-266221-2cdeff930000   Ready    <none>   5m18s   v1.29.2
lke184126-266221-60b9991f0000   Ready    <none>   5m16s   v1.29.2
essawey@essawey:~$ kubectl cluster-info
Kubernetes control plane is running at https://65103252-dc8a-4d36-9a47-cd6477eceab4.ca-central-1.linodelke.net:443
KubeDNS is running at https://65103252-dc8a-4d36-9a47-cd6477eceab4.ca-central-1.linodelke.net:443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.
essawey@essawey:~$ kubectl run essaweypod --image=mohamedessawey/malware-classification --port=80
pod/essaweypod created
essawey@essawey:~$ kubectl get pods
NAME         READY   STATUS              RESTARTS   AGE
essaweypod   0/1     ContainerCreating   0          15s
essawey@essawey:~$ kubectl get pods
NAME         READY   STATUS              RESTARTS   AGE
essaweypod   0/1     ContainerCreating   0          22s
essawey@essawey:~$ kubectl get pods
NAME         READY   STATUS    RESTARTS   AGE
essaweypod   1/1     Running   0          111s
essawey@essawey:~$ nano essaweydeployment.yaml
essawey@essawey:~$ kubectl get pods
NAME         READY   STATUS    RESTARTS      AGE
essaweypod   1/1     Running   3 (55s ago)   6m11s
essawey@essawey:~$ kubectl delete pods essaweypod
pod "essaweypod" deleted
essawey@essawey:~$ kubectl apply -f essaweydeployment.yaml
deployment.apps/essawey-deployment created
essawey@essawey:~$ kubectl get pods
NAME                                 READY   STATUS              RESTARTS   AGE
essawey-deployment-df4bfb84d-grnsh   0/1     ContainerCreating   0          8s
essawey-deployment-df4bfb84d-mcgkh   0/1     ContainerCreating   0          8s
essawey-deployment-df4bfb84d-vsl2g   1/1     Running             0          8s
essawey@essawey:~$ kubectl get pods
NAME                                 READY   STATUS              RESTARTS      AGE
essawey-deployment-df4bfb84d-grnsh   0/1     ContainerCreating   0             68s
essawey-deployment-df4bfb84d-mcgkh   0/1     ContainerCreating   0             68s
essawey-deployment-df4bfb84d-vsl2g   1/1     Running             1 (21s ago)   68s
essawey@essawey:~$ kubectl get deployments
NAME                 READY   UP-TO-DATE   AVAILABLE   AGE
essawey-deployment   1/3     3            1           86s
essawey@essawey:~$ kubectl get deployments
NAME                 READY   UP-TO-DATE   AVAILABLE   AGE
essawey-deployment   2/3     3            2           108s
essawey@essawey:~$ kubectl get pods -o wide
NAME                                 READY   STATUS    RESTARTS      AGE    IP           NODE                            NOMINATED NODE   READINESS GATES
essawey-deployment-df4bfb84d-grnsh   1/1     Running   1 (16s ago)   3m1s   10.2.1.5     lke184126-266221-29d3fcf00000   <none>           <none>
essawey-deployment-df4bfb84d-mcgkh   1/1     Running   0             3m1s   10.2.0.131   lke184126-266221-60b9991f0000   <none>           <none>
essawey-deployment-df4bfb84d-vsl2g   1/1     Running   2 (90s ago)   3m1s   10.2.0.3     lke184126-266221-2cdeff930000   <none>           <none>
essawey@essawey:~$ nano essawey-service.yaml
essawey@essawey:~$ kubectl apply -f essawey-service.yaml
service/essawey-service created
essawey@essawey:~$ kubectl get services
NAME              TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)        AGE
essawey-service   LoadBalancer   10.128.83.184   172.105.1.182   80:31529/TCP   14s
kubernetes        ClusterIP      10.128.0.1      <none>          443/TCP        25m
essawey@essawey:~$ kubectl get pods -o wide
NAME                                 READY   STATUS    RESTARTS        AGE   IP           NODE                            NOMINATED NODE   READINESS GATES
essawey-deployment-df4bfb84d-grnsh   1/1     Running   3 (6m10s ago)   25m   10.2.1.5     lke184126-266221-29d3fcf00000   <none>           <none>
essawey-deployment-df4bfb84d-mcgkh   1/1     Running   3 (5m53s ago)   25m   10.2.0.131   lke184126-266221-60b9991f0000   <none>           <none>
essawey-deployment-df4bfb84d-vsl2g   1/1     Running   7 (5m10s ago)   25m   10.2.0.3     lke184126-266221-2cdeff930000   <none>           <none>
essawey@essawey:~$ ls
essawey-service.yaml  essaweydeployment.yaml  kubeconfig.yaml  kubectl  ml-ops  snap
essawey@essawey:~$ cat essaweydeployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: essawey-deployment
  labels:
    app: mlops
spec:
  replicas: 3
  selector:
    matchLabels:
      app: mlops
  template:
    metadata:
      labels:
        app: mlops
    spec:
      containers:
      - name: mlops
        image: mohamedessawey/malware-classification:latest
        imagePullPolicy: Always
        ports:
        - containerPort: 80
essawey@essawey:~$ nano essaweydeployment.yaml
essawey@essawey:~$ nano kubeconfig.yaml
essawey@essawey:~$ nano essawey-service.yaml


Use "fg" to return to nano.

[1]+  Stopped                 nano essawey-service.yaml
essawey@essawey:~$ nano essawey-service.yaml
essawey@essawey:~$ cat essawey-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: essawey-service
  annotations:
    service.beta.kubernetes.io/linode-loadbalancer-throttle: "4"
  labels:
    app: essawey-service
spec:
  type: LoadBalancer
  ports:
  - name: http
    port: 5000
    protocol: TCP
    targetPort: 5000
  selector:
    app: mlops
  sessionAffinity: None
essawey@essawey:~$ kubectl get pods -o wide
NAME                                 READY   STATUS             RESTARTS        AGE    IP           NODE                            NOMINATED NODE   READINESS GATES
essawey-deployment-df4bfb84d-6wr7g   1/1     Running            0               8m1s   10.2.0.9     lke184126-266221-2cdeff930000   <none>           <none>
essawey-deployment-df4bfb84d-9fnvn   0/1     OOMKilled          0               7m5s   10.2.0.10    lke184126-266221-2cdeff930000   <none>           <none>
essawey-deployment-df4bfb84d-mcgkh   1/1     Terminating        3 (13m ago)     33m    10.2.0.131   lke184126-266221-60b9991f0000   <none>           <none>
essawey-deployment-df4bfb84d-vsl2g   0/1     CrashLoopBackOff   7 (3m49s ago)   33m    10.2.0.3     lke184126-266221-2cdeff930000   <none>           <none>
essawey@essawey:~$ kubectl get services
NAME              TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)        AGE
essawey-service   LoadBalancer   10.128.83.184   172.105.1.182   80:31529/TCP   24m
kubernetes        ClusterIP      10.128.0.1      <none>          443/TCP        50m
essawey@essawey:~$ kubectl apply -f essaweydeployment.yaml
deployment.apps/essawey-deployment configured
essawey@essawey:~$ kubectl run essaweypod --image=mohamedessawey/malware-classification --port=5000
pod/essaweypod created
essawey@essawey:~$ kubectl get pods -o wide
NAME                                  READY   STATUS        RESTARTS        AGE     IP           NODE                            NOMINATED NODE   READINESS GATES
essawey-deployment-56778bb497-2dcx2   1/1     Running       0               56s     10.2.1.12    lke184126-266221-29d3fcf00000   <none>           <none>
essawey-deployment-56778bb497-927x8   1/1     Running       0               58s     10.2.1.11    lke184126-266221-29d3fcf00000   <none>           <none>
essawey-deployment-56778bb497-vn479   1/1     Running       0               60s     10.2.1.10    lke184126-266221-29d3fcf00000   <none>           <none>
essawey-deployment-df4bfb84d-6wr7g    1/1     Terminating   0               9m44s   10.2.0.9     lke184126-266221-2cdeff930000   <none>           <none>
essawey-deployment-df4bfb84d-9fnvn    0/1     Terminating   0               8m48s   10.2.0.10    lke184126-266221-2cdeff930000   <none>           <none>
essawey-deployment-df4bfb84d-mcgkh    1/1     Terminating   3 (15m ago)     35m     10.2.0.131   lke184126-266221-60b9991f0000   <none>           <none>
essawey-deployment-df4bfb84d-vsl2g    0/1     Terminating   7 (5m32s ago)   35m     10.2.0.3     lke184126-266221-2cdeff930000   <none>           <none>
essaweypod                            0/1     Pending       0               16s     <none>       lke184126-266221-29d3fcf00000   <none>           <none>
essawey@essawey:~$ kubectl get deployments
NAME                 READY   UP-TO-DATE   AVAILABLE   AGE
essawey-deployment   0/3     3            0           35m
essawey@essawey:~$ kubectl get deployments
NAME                 READY   UP-TO-DATE   AVAILABLE   AGE
essawey-deployment   0/3     3            0           36m
essawey@essawey:~$ kubectl get pods -o wide
NAME                                  READY   STATUS        RESTARTS       AGE     IP           NODE                            NOMINATED NODE   READINESS GATES
essawey-deployment-56778bb497-2dcx2   1/1     Running       0              2m30s   10.2.1.12    lke184126-266221-29d3fcf00000   <none>           <none>
essawey-deployment-56778bb497-927x8   1/1     Running       0              2m32s   10.2.1.11    lke184126-266221-29d3fcf00000   <none>           <none>
essawey-deployment-56778bb497-vn479   1/1     Running       0              2m34s   10.2.1.10    lke184126-266221-29d3fcf00000   <none>           <none>
essawey-deployment-df4bfb84d-6wr7g    1/1     Terminating   0              11m     10.2.0.9     lke184126-266221-2cdeff930000   <none>           <none>
essawey-deployment-df4bfb84d-9fnvn    0/1     Terminating   0              10m     10.2.0.10    lke184126-266221-2cdeff930000   <none>           <none>
essawey-deployment-df4bfb84d-mcgkh    1/1     Terminating   4 (35s ago)    36m     10.2.0.131   lke184126-266221-60b9991f0000   <none>           <none>
essawey-deployment-df4bfb84d-vsl2g    0/1     Terminating   7 (7m6s ago)   36m     10.2.0.3     lke184126-266221-2cdeff930000   <none>           <none>
essaweypod                            0/1     Pending       0              110s    <none>       lke184126-266221-29d3fcf00000   <none>           <none>
essawey@essawey:~$ kubectl get services
NAME              TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)        AGE
essawey-service   LoadBalancer   10.128.83.184   172.105.1.182   80:31529/TCP   27m
kubernetes        ClusterIP      10.128.0.1      <none>          443/TCP        53m
essawey@essawey:~$ kubectl apply -f essawey-service.yaml
service/essawey-service configured
essawey@essawey:~$ kubectl get services
NAME              TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)          AGE
essawey-service   LoadBalancer   10.128.83.184   172.105.1.182   5000:31529/TCP   28m
kubernetes        ClusterIP      10.128.0.1      <none>          443/TCP          53m
essawey@essawey:~$ kubectl get deployments
NAME                 READY   UP-TO-DATE   AVAILABLE   AGE
essawey-deployment   0/3     3            0           37m
import wandb
import os
import csv
from config import WANDB_API_KEY
wandb.login(key=WANDB_API_KEY)
wandb.init(project='MALWARE-CLASSIFICATION', name='DEPLOYMENT')


with open("logs.txt", "r+") as file:
    total_runs = int(file.read()) + 1
    file.seek(0)
    file.write(str(total_runs))

def log_error_rate():
    with open("error_rate.txt", "r+") as file:
        error_rate = int(file.read())/total_runs
        print(error_rate)
        wandb.log({"Error Rate": error_rate})

def log_predictions(pair, file_name = 'predictions.csv'):
    file_exists = os.path.isfile(file_name)
    with open(file_name, mode='a', newline='') as file:
        writer = csv.writer(file)
        
        if not file_exists:
            writer.writerow(['Row Number', 'Model', 'Prediction', 'Actual'])
        writer.writerow(pair)
    log_error_rate()


def save_error_rate():
    with open("error_rate.txt", "r+") as file:
        error_rate = int(file.read()) + 1
        file.seek(0)
        file.write(str(error_rate))
